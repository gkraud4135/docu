1.[IAM 사용자와 그룹 생성]
 
1. 관리콘솔에  로그온 한다음 내 계정을 클릭한 뒤 드롭다운에서 [내 보안 자격 증명]을 클릭합니다. 리전은 서울로 선택합니다. 앞으로 모든 작업은 서울 리전에서 진행하겠습니다.
 2. 다음의 팝업창이 나타납니다. [Get started with IAM Users]를 클릭합니다. 또는 AWS Management 콘솔에서 [서비스] -> [IAM]으로 접속합니다.
  
3. 사용자 탭에서 [사용자 추가] 를 클릭합니다.
 
4. 신규 사용자의 이름을 원하는 대로 입력합니다.(iamuser01) 이것은 AWS에 로그인할 때 사용하는 이름입니다. 하나 이상의 사용자를 동시에 추가하려면, 추가하는 각 사용자에 대해 [다른 사용자 추가]를 선택한 후 사용자 이름을 입력합니다. 한 번에 최대 10명까지 사용자를 추가할 수 있습니다.

사용자 이름에는 최대 64개의 알파벳, 숫자 및 더하기(+), 등호(=), 쉼표(,), 마침표(.), 앳(@), 그리고 하이픈(-) 조합을 사용할 수 있습니다. 이름은 계정 내에서 고유해야 합니다. 대소문자는 구별하지 않습니다. 
액세스 유형은 AWS Management Console 액세스, 콘솔 비밀번호는 자동 생성되도록 체크하고 [다음]을 클릭합니다.
 
 5. 권한 설정에서 그룹을 생성할 수 있습니다. 그룹에 권한을 설정하고 유저를 추가하면, 일괄적으로 관리할 수 있어 편리합니다. 유저에게서 권한을 제거하고 싶을 때는 그룹에서 사용자를 제거하면 됩니다. [그룹에 사용자 추가]가 선택된 상태에서 그룹생성 단추를 클릭합니다.
 
6. 그룹 이름에 ec2group이라 입력하고 화면을 스크롤하여 ‘amazon EC2 Full Access’를 체크합니다. EC2서비스의 관리자 권한을 해당 그룹에 부여하는 것입니다. 화면하단의 [그룹 생성]을 클릭합니다.
 
7.ec2그룹에 AmazonEC2FullAccess이 연결된 정책으로 표시되면  [다음: 태그]를 클릭합니다.태그추가 화면이 표시되면 화면 하단의 다음:검토 단추를 클릭합니다
 
8. 사용자 세부 정보와 권한 요약을 확인하고 [사용자 만들기]를 클릭합니다.
 
9. 밑줄 친 위치에는 사용자의 콘솔 액세스 주소를 알려줍니다. 해당 주소를 통해 IAM 유저로 로그인 할 수 있습니다. 사용자의 액세스 키(액세스 키 ID와 보안 액세스 키)를 보려면 보고 싶은 각 암호와 액세스 키 옆에 있는 표시를 선택합니다. 액세스 키를 저장하려면 [.csv 다운로드]를 선택한 후 안전한 위치에 파일을 저장합니다.

*중요
보안 액세스 키는 이 때만 확인 및 다운로드가 가능하기 때문에 사용자에게 AWS API를 사용하도록 하려면 이 정보를 제공해야 합니다. 사용자의 새 액세스 키 ID와 보안 액세스 키를 안전한 장소에 보관하십시오. 이 단계가 지난 후에는 보안 키에 다시 액세스할 수 없습니다.
 
10. 닫기 단추를 클릭하면 iamuser01 사용자가 생성된 것을 볼 수 있습니다. 
EC2관리권한을 할당한  ec2group에 iamuser01 사용자가 구성성으로 표시되는가를 확인합니다
확인이 된다면 앞으로는 이 IAM 유저로 로그인하여 EC2 인스턴스에 대한 모든 관리 작업을  수행할 수 있습니다.
필요하다면 AdministratorAccess정책을 연결한 관리자계정을 만들어서 모든 관리 작업을 수행 수 도 있고, 루트 계정을 안전하게 보관할 수 있습니다.

2.[IAM 사용자로 AWS콘솔에 접속하기]

1.AWS 계정뿐 아니라 IAM 사용자도 관리콘솔에 접속 할 수 있습니다.
IAM 사용자가 콘솔에 접속하려면 암호를 설정해야 합니다. 
IAM 사용자 목록에서 iamuser01 사용자를 선택하고 요약화면에서 보안자격 증명탭을 클릭하고 콘솔 비밀번호 부분에 관리를 클릭합니다.
콘솔 액세스관리 화면에서 사용자 지정 비밀번호를 선택후 비번 'Pa$$w0rd'를 입력후 적용 단추를 클릭합니다. 

2.IAM 사용자용 콘솔의 주소는 IAM 대시보드에서 확인 할수 있습니다.
왼쪽메뉴에서 대시보드를 클릭하고 IAM 사용자 로그인 링크를 클릭합니다.
로그인 링크는 아래와 같은 형식입니다.주소뒤 링크복사단추를 사용하여 링크를 복사합니다
https://aws계정ID.signin.aws.amazon.com/console

3.브라우저를 열고 복사된 링크주소를 붙여넣고 생성한 계정과 암호로 로그인합니다
4.로그인이 되면 화면우측 상단 이름표시부분에 자신의 이름대신 iamuser01@4535-4974-4820가 표시됩니다.
5.EC2 서비스로 이동해서 EC2인스턴스를 생성할수도 있고 관리도 가능합니다.
S3 서비스를 검색해서 이동해보면 해당서비스에는 어떠한 권한도 없기때문에 access denied 오류발생이 화면에 표시됩니다.
6.로그아웃하고 루트 사용자 이메일 주소를 이용 root계정으로 로그인하여 다음 실습을 준비합니다.

3.[IAM 역할 생성]
1.IAM 액세스관리에서 역할을 클릭하고 화면에서 역할 만들기 단추를 클릭합니다. 
2.역할만들기 화면에서 EC2 인스턴스용 역할을 만들기 위해  일반사용사례의 EC2를 클릭하고 화면하단 다음:권한 단추가 활성화되면 단추를 클릭합니다.
3.권한정책 연결화면에서 정책필터 검색창에 EC2라고 입력하고 amazonEC2FullAccess가 나타나면 선택하고 [다음:태그] 단추를 클릭합니다.IAM 역할이 EC2에만 접근할 수 있도록 설정됩니다.
4.태그추가 화면에서 하단의 [다음:검토]단추를 클릭합니다.
5.검토화면에서 역할이름에 EC2roletest 를 입력하고 화면하단의 역할 만들기 단추를 클릭합니다.
이로서 IAM 역할 목록에  EC2roletest 이라는 역할이 작성되었습니다.
왼쪽에서 역할을 클릭하여 작성한 EC2roletest 이 표시되는가를 확인합니다.

4.[루트사용자로 로그인하여 IAM역할을 사용하는 EC2인스턴스 작성] 

EC2인스턴스 역할은 EC2인스턴스를 만들때 설정해야합니다.
이미 작성된 인스턴스에는 역할을 설정하지 못합니다.

1.EC2인스턴스 페이지에서 인스턴스시작 단추를 클릭하여 인스턴스를 작성합니다.

2.프리티어만을 클릭하여 나타나는 AMI 템플릿 목록에서 첫번째 "Amazon Linux AMI 2018.03.0 (HVM), SSD Volume Type "을 선택합니다

3.단계 2: 인스턴스 유형 선택 화면 하단에서  다음:인스턴스 세부정보구성 단추를 클릭합니다.

4.단계 3: 인스턴스 세부 정보 구성에서 IAM 역할 설정을  할 수 있습니다.
이전 실습에서 만든 EC2RoleTest 역할을 선택하고 검토 및 시작단추를 클릭하고 기존의 키를 사용하여 새 인스턴스를 만듭니다.

6.만들어진 EC2인스턴스가 잘 동작 중인지 확인합니다.

EC2인스턴스에서 IAM역할을 사용시 IAM역할을 삭제하면 절대 안됩니다
만일 삭제한다면 즉시 EC2인스턴스에서 AWS리소스로 접근권한이 없어집니다.



