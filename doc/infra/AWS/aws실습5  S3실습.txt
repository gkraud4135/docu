실습5 S3실습

S3 버킷 생성하기
-----------------

1.AWS 콘솔로 접속후 메인화면에서 스토리지서비스에서 S3를 클릭합니다.

2.S3메인 페이지에서 버킷만들기 단추를 클릭하고 대화상자에서 정보를 입력합니다

버킷이름:samplebucket000
리전:아시아태평양(서울)

3.작성할 버킷이름은 S3에 접근할 수있는 URL이 부여되므로 모든 s3리전 중에서 유일해야합니다(동일이름의 버킷이 있다고 표시되면 이름뒤에 임의의 숫자를을 부여하면서 시도합니다)
버킷은 각 리전별로 생성됩니다.

4.속성화면에서 태그부분에 Name 입력하고 값 필드에 samplebucket이라 입력후 다음단추를 누릅니다

5.권한설정 화면에서 모든퍼븍릭액세스차단이 선택되있는가 확인후 다음을 누릅니다.

6.검토화면을 확인하고 화면하단의 버킷만들기를 클릭합니다.

버킷이 생성되고 만들어진 버킷을 클릭하여  나타나는 버킷정보를 확인후 정보창을 닫습니다.

화면에소는 페이지에서 생성한 모든 버킷목록이 표시됩니다
S3는 리전별로 페이지가 구분되지 않고 이 페이지에서 모두 표시됩니다.

버킷에 파일올리기와 받기
------------------------
1.s3버킷 목록에서 생성한 samplebucket000을 클릭합니다
버킷안의 객체목록으로 들어가면 방금생성한 버킷안에는 아무것도 들어있지 않습니다 위쪽의 업로드 단추를 클릭합니다.

2.파일추가 단추를 클릭하거나 드래그앤 드롭방식으로 추가할 아무 그림파일하나를 선택합니다.

3.파일이 업로드 대기 목록에 추가된 것을 알 수 있습니다.다음을 클릭하고 권한설정화면을 검토합니다. 필요시 다른 AWS 계정에 대한 액세스 부분에 계정추가단추를 이용해 권한을 부여 할 수도 있습니다.  
여기서는 아무것도 설정하지않고 다음을 눌러 기본값으로 진행합니다 

4.스토리지 클래스 화면이 나오면 종류,암호화,메타데이터부분을 검토후 스탠다드 클래스가 선택되어 있는지 확인후 다음을 클릭합니다.

5.속성설정 창에서 표시된 내용을 확인후 업로드를 클릭합니다.

6.파일의 용량이크다면 업로드시 화면 하단에 진행바에거 진행률이 표시됩니다.S3목록에서 그림파일이 업로드된것을 확인할 수있습니다.

7.S3목록에서 파일을 선택하면 나타나는 정보창에서 적절한 액션을 수행할 수 있습니다.다운로드를 클릭하여 그림파일을 다운로드 할 수 잇습니다.

참고
S3는 버킷내의 파일들에 접근하기 위한 다양한 GUI 클라이언트들이 있습니다
콘솔로 버킷에 접근하는것보다 좀더 편리하고 직관적인 이용이 가능합니다

* cloudBerry Explorer
https://www.msp360.com/explorer/windows/amazon-s3.aspx

*Bucket Explorer
https://bucket-explorer.en.softonic.com/

S3 객체 권한 관리하기
----------------------

S3에 올라간 파일을 객체라고 합니다.
S3에서는 이 객체마다 각각의 접근권한을 설정할 수 있습니다
S3 버킷의 객체목록에서 파일을 선택하고 개요부분의 객체 URL을 클릭하면 웹브라우저가 열리고 링크의 내용이 표시되지만 Access Denied라는 에러가 표시되고 그림파일은 열리지 않습니다

이 객체를 인터넷에 공개하려면
 
1.버킷을 선택하고 퍼블릭액세스 설전 편집단추를 클릭합니다

2.선택한 버킷에 대한 퍼블릭 액세스 차단 편집 설정화면에서 모든 퍼블릭액세스차단 부분을 해제하고 저장단추를 누릅니다

3.선택한 버킷에 대한 퍼블릭 액세스 차단 편집 설정 화면에서 확인을 입력하고 확인 단추를 누릅니다

4.화면의 액세스 컬럼에서 객체를 퍼블릭으로 설정 할 수 있음으로 표시됩니다

5.공개할 파일객체를 선택하고 작업단추를 클릭하고 퍼블릭으로 설정을 클릭합니다

6.퍼블릭으로 설정창에서 퍼블릭으로 설정 단추를 누릅니다

7.설정된 해당파일을 클릭하여 개요 탭아래 객체 url 링크를 클릭하여 해당 파일이 표시되는지 확인합니다.

S3정적 웹사이트 호스팅
-------------------------
S3를 웹서버 형태로 사용 정적 웹사이트 호스팅 설정을 하지 않더라도 S3에 파일을 올리면 웹브라우저로 파일에 접근 가능합니다.
하지만  그냥사용하는 것과 정적 웹사이트를 사용하는 것은 차이점이 있습니다.

일반적인 S3의 URL 형태

http://s3-ap-northeast-1.amazonaws.com/samplebucket000/cat.jpg
S3-(리전이름).amazonaws.com/(버킷이름)/(파일이름)

정적 웹사이트 호스팅을 사용한 S3의  URL 형태

http://samplebucket000.s3-website-ap-northeast-1.amazonaws.com/cat.jpg
(버킷이름).s3-website-(리전이름).amazonaws.com/(파일이름)

이를 S3 website Endpoint 라고 합니다.

정적웹사이트 호스팅 설정을 이용하면 인덱스페이지와 에러페이지의 파일명을 따로 지정해줄 수 있고 다양한 리다이렉션 동작을 웹서버로 하여금 할 수 있게 합니다.즉 S3버킷 도메인인 samplebucket000.s3-website-ap-northeast-1.amazonaws.com 도메인을 sample.com과 같은 짧은 이름의 다른도메인으로 리다이렉션 할 수도 있는 것입니다.

1.S3버킷목록에서 버킷만들기를 클릭합니다.
버킷이름:samplewebhosting000
리전:아시아 태평양(서울) 
입력 선택하고 다음을 클릭합니다.

2.퍼블릭 액세스 차단(버킷 설정)화면에서 모든 퍼블릭 액세스 차단을 해제하면 [모든 퍼블릭 액세스 차단]을 비활성화하면 이 버킷과 그 안에 포함된 객체가 퍼블릭 상태가 될 수 있습니다. 경고상자에 현재 설정으로 인해 이 버킷과 그 안에 포함된 객체가 퍼블릭 상태가 될 수 있음을 알고 있습니다 를 선택하고 다음 단추를 클릭합니다.  버킷만들기 단추를 클릭하여 버킷생성을 완료합니다.

3.생성된 버킷권한 탭에서 버킷정책 메뉴를 클릭하고 버킷 정책 편집기화면에서 아래 JSON 텍스트를 입력합니다

{
    "Version": "2008-10-17",
    "Id": "Policy1397993518062",
    "Statement": [
        {
            "Sid": "Stmt1397993241249",
            "Effect": "Allow",
            "Principal": {
                "AWS": "*"
            },
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::samplewebhosting000/*"
        }
    ]
}		

입력이 끝났으면 저장단추를 클릭합니다	

4.속성 탭에서 정적 웹 사이트 호스팅을 클릭 후 이 버킷을 사용하여 웹 사이트를 호스팅합니다 를 선택 후 인덱스 문서 칸에 index.html을 입력 후 저장 단추를 클릭합니다.
정적 웹 사이트 호스팅 상자아래 버킷호스팅이 활성화되어 표시됩니다.

5.메모장을 이용하여 아래와 같은 코드의 index.htm 파일을 작성하고 저장후 호스팅을 설정한 버킷에 업로드합니다.
<html>
<head>	
	<title>S3 Sample Website Hosting </title>
</head>
<body>
	<p> Hello!! S3 Service </p>
</body> 
</html>

6.업로드가 완료되면 속성탭에 정적 호스팅을 클릭하면 S3웹사이트의 엔드포인트를 볼수 있습니다(엔드포인트: http://samplewebhosting000.s3-website.ap-northeast-2.amazonaws.com)
엔드포인트 링크를 클릭하면  웹브라우저에서 이전에 생성한 index.html문서의 내용이 표시됩니다.

